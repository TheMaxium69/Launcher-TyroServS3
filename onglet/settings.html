<!DOCTYPE html>
<html>
    <!--Create By Maxime Tournier-->
<head>

    <!-- BASE -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- EXTENSION -->
    <link rel="stylesheet" href="../extension/iziToast.css">
    <script type="text/javascript" src="../extension/iziToast.js"></script>
    <link rel="stylesheet" href="../extension/remixicon/remixicon.css">
    <link rel="stylesheet" href="../extension/fontawesome/css/all.css">

    <!-- CSS -->
    <link rel="stylesheet" href="../css/index.css">
    <link rel="stylesheet" href="../css/navbar.css">
    <link rel="stylesheet" href="../css/panel.css">
    <link rel="stylesheet" href="../css/scrollOnglet.css">
    <link rel="stylesheet" href="../css/settings.css">

</head>

<body id="setting">

<!--NAVBAR -->
<nav style="-webkit-app-region: drag">
    <img src="../asset/logo.png" width="20px" style="margin-left: 10px">
    <p id="title"></p>
    <div class="nav-buttons">
        <button id="closeOnglet"><i class="fa-solid fa-xmark"></i></button>
    </div>
</nav>

<!-- ONGLET SETTING -->
<main class="custom-scrollbar">

    <h2 class="up-title"><i class="ri-settings-3-fill icone-left"></i> PREFERENCE</h2>

    <section id="setting-game">
        <h3 class="sub-title">Paramètre du jeux</h3>

        <article class="param-block">
            <div>
                <h4 class="param-name"><i class="ri-corner-down-right-fill"></i> Mémoire du jeux </h4>
                <p class="param-sub-name">Combien de ram pour votre instance Minecraft (GigaOctet)</p>
            </div>

            <div class="btn-param subligne">
                <div class="ram-info">min :</div>
                <input id="RamMin" style="width: 73px;" type="text" class="champ-btn-param" placeholder="4" value="4">
                <div class="ram-info">max :</div>
                <input id="RamMax" style="width: 73px;" type="text" class="champ-btn-param" placeholder="8" value="8">
            </div>
        </article>

        <article class="param-block">
            <div>
                <h4 class="param-name"><i class="ri-corner-down-right-fill"></i> Résolution du jeux</h4>
                <p class="param-sub-name">Definir la résolution de votre instance Minecraft</p>
            </div>

            <div class="btn-param subligne">
                <input id="ResoWidth" type="text" class="champ-btn-param" placeholder="854" value="854">
                <div id="resolution-X">X</div>
                <input id="ResoHeight" type="text" class="champ-btn-param" placeholder="480" value="480">
            </div>

        </article>

        <article class="param">
            <div>
                <h4 class="param-name"><i class="ri-corner-down-right-fill"></i> Après le Lancement du jeux</h4>
                <p class="param-sub-name">Séléctionnez l’action de votre launcher une fois votre jeux lancé</p>
            </div>


            <div class="btn-param">
                <div class="socle-btn-param">
                    <button id="showLauncherFalse" class="active">Caché</button>
                    <button id="showLauncherTrue" class="">Affiché</button>
                </div>
            </div>

        </article>

    </section>

    <section id="setting-account">
        <h3 class="sub-title">Paramètre de compte</h3>

        <article class="param">
            <div>
                <h4 class="param-name"><i class="ri-corner-down-right-fill"></i> Modifier votre compte Useritium</h4>
                <p class="param-sub-name">Accèdez à votre Compte Useritium</p>
            </div>

            <div class="btn-param">
                <button onclick="launchSite(window.URL_USERITIUM_INSCRIPTION)" class="btn-classic">Votre Compte <i class="ri-user-line"></i></button>
            </div>
        </article>

        <article class="param">
            <div>
                <h4 class="param-name"><i class="ri-corner-down-right-fill"></i> Ce déconnecter</h4>
                <p class="param-sub-name">Voulez vous, vous deconnectez de votre compte</p>
            </div>

            <div class="btn-param">
                <button id="decoUser" class="btn-classic btn-deco">Déconnexion <i class="ri-shut-down-line"></i></button>
            </div>
        </article>

    </section>

    <section id="setting-other">
        <h3 class="sub-title">Autre paramètre</h3>

        <article class="param">
            <div>
                <h4 class="param-name"><i class="ri-corner-down-right-fill"></i> Discord Rich Presence</h4>
                <p class="param-sub-name">Indique si votre statut de jeux doit être affiché sur Discord</p>
            </div>

            <div class="btn-param">
                <div class="socle-btn-param">
                    <button id="DiscordFalse" class="">Désactivé</button>
                    <button id="DiscordTrue" class="active">Activé</button>
                </div>
            </div>

        </article>

        <article class="param">
            <div>
                <h4 class="param-name"><i class="ri-corner-down-right-fill"></i> Console de Développement <i id="openConsole" style="color: white" class="ri-external-link-line"></i></h4>
                <p class="param-sub-name">Afficher la console de débogage, réservée aux initiés</p>
            </div>


            <div class="btn-param">
                <div class="socle-btn-param">
                    <button id="showConsoleFalse" class="active">Caché</button>
                    <button id="showConsoleTrue" class="">Affiché</button>
                </div>
            </div>

        </article>

    </section>

    <section id="setting-legal">
        <h3 class="sub-title">Légal</h3>
        <div id="info-launcher">

<!--            <p class="param-sub-name" style="margin: 0"><i class="ri-corner-down-right-fill"></i> TyroServ Saison : 3.0</p>-->
<!--            <p class="param-sub-name" style="margin: 0"><i class="ri-corner-down-right-fill"></i> TyroServ Launcher : 0.2.1</p>-->
<!--            <p class="param-sub-name" style="margin: 0"><i class="ri-corner-down-right-fill"></i> Useritium Version : V2.0</p>-->
<!--            <p class="param-sub-name" style="margin: 0"><i class="ri-corner-down-right-fill"></i> TyroMod Version : S3-0.2.0</p>-->

        </div>

        <div class="btn-legal">
            <button onclick="launchSite(window.URL_TYROSERV_SITEWEB_CGU)">CGU</button>
            <button onclick="launchSite(window.URL_TYROSERV_SITEWEB_CGV)">CGV</button>
            <button onclick="launchSite(window.URL_TYROSERV_SITEWEB_TERMS)">TERMS</button>
        </div>

        <p id="end-info">
            Copyright © 2017-2026 All Rights Reserved by <b onclick="launchSite('https://tyrolium.fr')">Tyrolium</b>.<br>
            Non afflié à <span onclick="launchSite('https://www.minecraft.net')">Mojang</span> ou <span onclick="launchSite('https://www.microsoft.com/')">Microsoft</span>
        </p>
    </section>


</main>

<!-- MAIN SCRIPT-->
<script>
    const { shell } = require('electron');
    const { ipcRenderer } = require('electron');
    const ipc = require("electron").ipcRenderer;

    /*
    *
    * AFFICHAGE DE BASE
    *
    * */

    /* NAVBAR*/
    document.querySelector("#closeOnglet").addEventListener("click", () => {
        ipc.send("manualCloseOngletSettings");
    });

    baseView();
    function baseView(){

        /* Titre Navbar */
        document.getElementById("title").innerText = window.NAME_LAUNCHER + " - " + window.ONGLET_SETTING_NAME;
    }

    /*
    *
    * RECUPERATION DES BUTTON
    *
    * */

    var RamMin = document.getElementById("RamMin")
    var RamMax = document.getElementById("RamMax")
    var ResoWidth = document.getElementById("ResoWidth")
    var ResoHeight = document.getElementById("ResoHeight")
    var showConsoleFalse = document.getElementById("showConsoleFalse")
    var showConsoleTrue = document.getElementById("showConsoleTrue")
    var showLauncherFalse = document.getElementById("showLauncherFalse")
    var showLauncherTrue = document.getElementById("showLauncherTrue")
    var DiscordFalse = document.getElementById("DiscordFalse")
    var DiscordTrue = document.getElementById("DiscordTrue")
    var openConsole = document.getElementById("openConsole")

    /*
    *
    * INIT SETTING
    *
    * */

    // DB SETTING
    let settingsContenu;

    // RECUPERATION DE SETTINGS FILE
    ipcRenderer.send("getSettingsFile");
    ipcRenderer.on("settingsFile", (event, settingsFile) => {
        // console.log(settingsFile);
        setActualyValeur(settingsFile);
        settingsContenu = settingsFile;
    });

    // AFFICHAGE DE SETTINGS FILE
    function setActualyValeur(settingsFile){

        RamMin.value = settingsFile.RamMin
        RamMax.value = settingsFile.RamMax
        ResoWidth.value = settingsFile.width
        ResoHeight.value = settingsFile.height

        if (settingsFile.showLauncher === true){
            showLauncherTrue.classList.add("active");
            showLauncherFalse.classList.remove("active");
        } else {
            showLauncherTrue.classList.remove("active");
            showLauncherFalse.classList.add("active");
        }

        if (settingsFile.console === true){
            showConsoleTrue.classList.add("active");
            showConsoleFalse.classList.remove("active");
        } else {
            showConsoleTrue.classList.remove("active");
            showConsoleFalse.classList.add("active");
        }

        if (settingsFile.discordReachPresence === true){
            DiscordTrue.classList.add("active");
            DiscordFalse.classList.remove("active");
        } else {
            DiscordTrue.classList.remove("active");
            DiscordFalse.classList.add("active");
        }

    }

    /*
    *
    * UPDATE SETTING
    *
    * */


    // RAM MIN
    RamMin.addEventListener('input', (event) => {
        settingsContenu.RamMin = +event.target.value;
        ipcRenderer.send("setSettingsFile", {newJson: settingsContenu});
    });

    // RAM MAX
    RamMax.addEventListener('input', (event) => {
        settingsContenu.RamMax = +event.target.value;
        ipcRenderer.send("setSettingsFile", {newJson: settingsContenu});
    });

    // Resolution Width
    ResoWidth.addEventListener('input', (event) => {
        settingsContenu.width = +event.target.value;
        ipcRenderer.send("setSettingsFile", {newJson: settingsContenu});
    });

    // Resolution Height
    ResoHeight.addEventListener('input', (event) => {
        settingsContenu.height = +event.target.value;
        ipcRenderer.send("setSettingsFile", {newJson: settingsContenu});
    });

    // showLauncher FALSE
    showLauncherFalse.addEventListener("click", () => {
        showLauncherTrue.classList.remove("active");
        showLauncherFalse.classList.add("active");
        settingsContenu.showLauncher = false;
        ipcRenderer.send("setSettingsFile", {newJson: settingsContenu});
    });

    // showLauncher TRUE
    showLauncherTrue.addEventListener("click", () => {
        showLauncherTrue.classList.add("active");
        showLauncherFalse.classList.remove("active");
        settingsContenu.showLauncher = true;
        ipcRenderer.send("setSettingsFile", {newJson: settingsContenu});
    });

    // showConsole FALSE
    showConsoleFalse.addEventListener("click", () => {
        showConsoleTrue.classList.remove("active");
        showConsoleFalse.classList.add("active");
        settingsContenu.console = false;
        ipcRenderer.send("setSettingsFile", {newJson: settingsContenu});
    });

    // showConsole TRUE
    showConsoleTrue.addEventListener("click", () => {
        showConsoleTrue.classList.add("active");
        showConsoleFalse.classList.remove("active");
        settingsContenu.console = true;
        ipcRenderer.send("setSettingsFile", {newJson: settingsContenu});
    });

    // discordReachPresence FALSE
    DiscordFalse.addEventListener("click", () => {
        DiscordTrue.classList.remove("active");
        DiscordFalse.classList.add("active");
        settingsContenu.discordReachPresence = false;
        ipcRenderer.send("setSettingsFile", {newJson: settingsContenu, discord: 'stop'});
    });

    // discordReachPresence TRUE
    DiscordTrue.addEventListener("click", () => {
        DiscordTrue.classList.add("active");
        DiscordFalse.classList.remove("active");
        settingsContenu.discordReachPresence = true;
        ipcRenderer.send("setSettingsFile", {newJson: settingsContenu, discord: 'start'});
    });

    // DECONNEXION
    document.getElementById("decoUser").addEventListener("click", () => {
        ipc.send("manualCloseOnglet");
        ipc.send("deconnexionUser");
    });

    // Reception de la mise a jour
    ipcRenderer.on("settingsFileUpdated", (event, data) => {
        let infoUpdate = data;

        // console.log(infoUpdate);
        if (infoUpdate.discord){
            if (infoUpdate.discord == 'start'){
                ipcRenderer.send("updateDiscord", {state: 'start'});
            } else if (infoUpdate.discord == 'stop') {
                ipcRenderer.send("updateDiscord", {state: 'stop'});
            }
        }
    });


    /*
    *
    * GESTION DE API GET LAUNCHER
    *
    * */

    var dataInfoLauncher = [];

    // RECUPERATION DES INFO D'API GET LAUNCHER
    ipcRenderer.send("getInfoLauncher");

    // AFFICHAGE DES INFO D'API GET LAUNCHER
    ipcRenderer.on("setInfoLauncher", (event, data) => {
        dataInfoLauncher = data;

        // Sélectionnez l'élément HTML où vous souhaitez ajouter vos articles
        var conteneurVersion = document.getElementById("info-launcher");

        // Boucle forEach pour générer les articles dynamiquement
        dataInfoLauncher.forEach(function (info) {
            var nouvelArticle = document.createElement("p");
            nouvelArticle.className = "param-sub-name";
            nouvelArticle.style.margin = "0";

            var icon = document.createElement("i");
            icon.className = "ri-corner-down-right-fill";

            nouvelArticle.appendChild(icon);
            nouvelArticle.appendChild(document.createTextNode(" " + info.name + " : " + info.version));
        
            conteneurVersion.appendChild(nouvelArticle);
        });

    });

    /*
    * 
    * OPEN CONSOLE
    * 
    * */

    openConsole.addEventListener("click", () => {
        ipcRenderer.send("launchConsole");
    });
    
    
    /*
    *
    * UTILITAIRE
    *
    * */

    // LANCEMENT DE SITE
    function launchSite(url){
        shell.openExternal(url);
    }

    // NOTIFICATION
    function notif(status, why){
        if(status == "true"){

            iziToast.success({
                title: 'OK',
                message: why,
            });

            playbtn.disabled = true;

        }
        if(status == "err"){

            iziToast.error({
                title: 'Erreur',
                message: why,
            })

        }
        if(status == "info"){

            iziToast.info({
                title: 'Info',
                message: why,
            })

        }
    }

</script>

</body>

</html>