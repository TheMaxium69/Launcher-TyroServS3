<!DOCTYPE html>
<html>
    <!--Create By Maxime Tournier-->
<head>

    <!-- BASE -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- EXTENSION -->
    <link rel="stylesheet" href="../extension/iziToast.css">
    <script type="text/javascript" src="../extension/iziToast.js"></script>
    <link rel="stylesheet" href="../extension/remixicon/remixicon.css">
    <link rel="stylesheet" href="../extension/fontawesome/css/all.css">

    <!-- CSS -->
    <link rel="stylesheet" href="../css/index.css">
    <link rel="stylesheet" href="../css/navbar.css">
    <link rel="stylesheet" href="../css/panel.css">
    <link rel="stylesheet" href="../css/scrollOnglet.css">
    <link rel="stylesheet" href="../css/mods.css">

</head>

<body id="mods">

<!--NAVBAR -->
<nav style="-webkit-app-region: drag">
    <img src="../asset/logo.png" width="20px" style="margin-left: 10px">
    <p id="title"></p>
    <div class="nav-buttons">
        <button id="closeOnglet"><i class="fa-solid fa-xmark"></i></button>
    </div>
</nav>

<!-- ONGLET MOD -->
<main class="custom-scrollbar">

    <section id="mods-unlock">
        <h2 class="mods-title">
            <i class="ri-corner-left-down-line"></i>
            MODS OPTIONNEL
        </h2>
        <div id="allModsOptionnal">
            <!-- ... -->
        </div>
    </section>
    <section id="mods-lock">
        <h2 class="mods-title">
            <i class="ri-corner-left-down-line"></i>
            MODS OBLIGATOIRE
        </h2>
        <div id="allModsLock">
            <!-- ... -->
        </div>
    </section>

</main>

<!-- MAIN SCRIPT-->
<script>

    const { shell } = require('electron');
    const { ipcRenderer } = require('electron');
    const ipc = require("electron").ipcRenderer;

    /*
    *
    * AFFICHAGE DE BASE
    *
    * */

    /* NAVBAR*/
    document.querySelector("#closeOnglet").addEventListener("click", () => {
        ipc.send("manualCloseOngletMod");
    });

    baseView();
    function baseView(){

        /* Titre Navbar */
        document.getElementById("title").innerText = window.NAME_LAUNCHER + " - " + window.ONGLET_MOD_NAME;
    }

    /*
    *
    * GESTION DES MODS
    *
    * */

    // DB MODS
    var modsDataOptionnal = [];
    var modsDataLock = [];

    /* Activation/Desactivation des mods */
    function changeStateMods(modsID, state) {

        /* Recuperation des BTN*/
        var btnDesactive = document.getElementById("mods-desactivate-" + modsID)
        var btnActive = document.getElementById("mods-activate-" + modsID);

        /* Trouver le MOD */
        let mod = modsDataOptionnal.find(mod => mod.id === modsID);

        if (mod) {

            if (state === "desactive") {
                mod.activate = false;

                btnDesactive.classList.add("active");
                btnActive.classList.remove("active");
            }

            if (state === "active") {
                mod.activate = true;

                btnActive.classList.add("active");
                btnDesactive.classList.remove("active");
            }

            ipcRenderer.send("setModsFile", {newJson: modsDataOptionnal});
        }

    }

    /* Mise a jour de l'affichage des mods optionnel */
    function updateActivateMods(modsFileContenu){

        modsFileContenu.forEach(oneMod =>{

            var btnDesactive = document.getElementById("mods-desactivate-" + oneMod.id)
            var btnActive = document.getElementById("mods-activate-" + oneMod.id);

            if (btnDesactive && btnActive) {
                if (oneMod.activate === true) {
                    btnActive.classList.add("active");
                    btnDesactive.classList.remove("active");
                } else {
                    btnDesactive.classList.add("active");
                    btnActive.classList.remove("active");
                }
            }

        });

    }

    /*
    *
    * AFFICHAGE DES MODS OPTIONNEL
    *
    * */

    /* Recuperation des mods optionnel */
    ipcRenderer.send("getModsOptionnal");

    /* Affichage des mods optionnel */
    ipcRenderer.on("setModsOptionnal", (event, data) => {
        modsDataOptionnal = data;

        // Sélectionnez l'élément HTML où vous souhaitez ajouter vos articles
        var conteneurMods = document.getElementById("allModsOptionnal");

        // Boucle forEach pour générer les articles dynamiquement
        modsDataOptionnal.forEach(function(mod) {

            // Créez un nouvel élément d'article
            var nouvelArticle = document.createElement("article");
            nouvelArticle.className = "article-mods";
            nouvelArticle.id = "mods-" + mod.id;

            // Créez l'élément de l'image du mod
            var ppMod = document.createElement("div");
            ppMod.className = "pp-mod";
            ppMod.style.backgroundImage = "url('" + mod.imageUrl + "')";
            nouvelArticle.appendChild(ppMod);

            // Créez l'élément d'informations du mod
            var infoMod = document.createElement("div");
            infoMod.className = "info-mod";

            // Ajoutez le nom et la version du mod
            var nomEtVersion = document.createElement("h2");
            nomEtVersion.className = "mods-name";
            if (mod.versionAlias){
                nomEtVersion.innerHTML = mod.nom + " <span>(" + mod.versionAlias + ")</span>";
            } else {
                nomEtVersion.innerHTML = mod.nom + " <span>(" + mod.version + ")</span>";
            }
            infoMod.appendChild(nomEtVersion);

            // Ajoutez l'auteur du mod
            var auteur = document.createElement("p");
            auteur.innerHTML = '<i class="ri-corner-down-right-line"></i> By ' + mod.auteur;
            infoMod.appendChild(auteur);

            // Ajoutez les liens du mod
            var linkMod = document.createElement("div");
            linkMod.className = "link-mod";
            if (mod.btnInfo.link !== undefined){
                linkMod.innerHTML = linkMod.innerHTML + `<div onclick="launchSite('`+ mod.btnInfo.link +`')" class="btn-link-mod">Site Web <i class="ri-external-link-line"></i></div>`;
            }

            if (mod.btnInfo.curseforge !== undefined){
                linkMod.innerHTML = linkMod.innerHTML + `<div onclick="launchSite('`+ mod.btnInfo.curseforge +`')" class="btn-link-mod">CurseForge <i class="ri-external-link-line"></i></div>`;
            }

            if (mod.btnInfo.github !== undefined){
                linkMod.innerHTML =  linkMod.innerHTML + `<div onclick="launchSite('`+ mod.btnInfo.github +`')" class="btn-link-mod">GitHub <i class="ri-external-link-line"></i></div>`;

            }
            infoMod.appendChild(linkMod);

            nouvelArticle.appendChild(infoMod);

            var btnMod = document.createElement("div");
            btnMod.className = "btn-mod";
            if (mod.activate === true){
                btnMod.innerHTML = `<div class="socle-btn-mod">
                                    <button id="mods-desactivate-` + mod.id + `" onclick="changeStateMods(`+ mod.id +`, 'desactive')">Désactivé</button>
                                    <button id="mods-activate-` + mod.id + `" onclick="changeStateMods(`+ mod.id +`, 'active')" class="active">Activé</button>
                                </div>`;
            } else {
                btnMod.innerHTML = `<div class="socle-btn-mod">
                                    <button id="mods-desactivate-` + mod.id + `" onclick="changeStateMods(`+ mod.id +`, 'desactive')" class="active">Désactivé</button>
                                    <button id="mods-activate-` + mod.id + `" onclick="changeStateMods(`+ mod.id +`, 'active')">Activé</button>
                                </div>`;
            }
            nouvelArticle.appendChild(btnMod);

            // Ajoutez l'article au conteneur
            conteneurMods.appendChild(nouvelArticle);
        });

        // GET MODS FILE
        ipcRenderer.send("getModsFile");

    });

    /* RECUPERATION DU FICHIER MODS */
    ipcRenderer.on("modsFile", (event, modsFile) => {
        console.log(modsFile);
        updateActivateMods(modsFile);
    });

    /*
    *
    * AFFICHAGE DES MODS LOCK
    *
    * */

    /* Recuperation des mods lock */
    ipcRenderer.send("getModsLock");

    /* Affichage des mods lock */
    ipcRenderer.on("setModsLock", (event, data) => {
        modsDataLock = data;

        // Sélectionnez l'élément HTML où vous souhaitez ajouter vos articles
        var conteneurMods = document.getElementById("allModsLock");

        // Boucle forEach pour générer les articles dynamiquement
        modsDataLock.forEach(function(mod) {
            // Créez un nouvel élément d'article
            var nouvelArticle = document.createElement("article");
            nouvelArticle.className = "article-mods";
            nouvelArticle.id = "mods-" + mod.id;

            // Créez l'élément de l'image du mod
            var ppMod = document.createElement("div");
            ppMod.className = "pp-mod";
            ppMod.style.backgroundImage = "url('" + mod.imageUrl + "')";
            nouvelArticle.appendChild(ppMod);

            // Créez l'élément d'informations du mod
            var infoMod = document.createElement("div");
            infoMod.className = "info-mod";

            // Ajoutez le nom et la version du mod
            var nomEtVersion = document.createElement("h2");
            nomEtVersion.className = "mods-name";
            if (mod.versionAlias){
                nomEtVersion.innerHTML = mod.nom + " <span>(" + mod.versionAlias + ")</span>";
            } else {
                nomEtVersion.innerHTML = mod.nom + " <span>(" + mod.version + ")</span>";
            }
            infoMod.appendChild(nomEtVersion);

            // Ajoutez l'auteur du mod
            var auteur = document.createElement("p");
            auteur.innerHTML = '<i class="ri-corner-down-right-line"></i> By ' + mod.auteur;
            infoMod.appendChild(auteur);

            // Ajoutez les liens du mod
            var linkMod = document.createElement("div");
            linkMod.className = "link-mod";
            if (mod.btnInfo.link !== undefined){
                linkMod.innerHTML = linkMod.innerHTML + `<div onclick="launchSite('`+ mod.btnInfo.link +`')" class="btn-link-mod">Site Web <i class="ri-external-link-line"></i></div>`;
            }

            if (mod.btnInfo.curseforge !== undefined){
                linkMod.innerHTML = linkMod.innerHTML + `<div onclick="launchSite('`+ mod.btnInfo.curseforge +`')" class="btn-link-mod">CurseForge <i class="ri-external-link-line"></i></div>`;
            }

            if (mod.btnInfo.github !== undefined){
                linkMod.innerHTML =  linkMod.innerHTML + `<div onclick="launchSite('`+ mod.btnInfo.github +`')" class="btn-link-mod">GitHub <i class="ri-external-link-line"></i></div>`;

            }
            infoMod.appendChild(linkMod);

            nouvelArticle.appendChild(infoMod);

            var btnMod = document.createElement("div");
            btnMod.className = "btn-mod";
            btnMod.innerHTML = `<div class="socle-btn-mod">
                                        <button class="desactive">Désactivé</button>
                                        <button class="active">Activé</button>
                                </div>`;
            nouvelArticle.appendChild(btnMod);

            // Ajoutez l'article au conteneur
            conteneurMods.appendChild(nouvelArticle);
        });

    });

    /*
    *
    * UTILITAIRE
    *
    * */

    // LANCEMENT DE SITE
    function launchSite(url) {
        shell.openExternal(url);
    }

    // NOTIFICATION
    function notif(status, why) {
        if (status == "true") {

            iziToast.success({
                title: 'OK',
                message: why,
            });

            playbtn.disabled = true;

        }
        if(status == "err"){

            iziToast.error({
                title: 'Erreur',
                message: why,
            })

        }
        if(status == "info"){

            iziToast.info({
                title: 'Info',
                message: why,
            })

        }
    }

</script>

</body>

</html>